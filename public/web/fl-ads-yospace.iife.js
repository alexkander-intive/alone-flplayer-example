/*! ******************************************************************************* 
   Package Name: fl-ads-yospace
   Generated: 2022-08-24
   Version: 7.0.56

   Copyright (C) Firstlight Media. All rights reserved.  
   
   All information contained herein is, and remains the property of Firstlight Media. 
   The intellectual and technical concepts contained herein are proprietary to 
   Firstlight Media.  

   Dissemination of this information or reproduction of this material is strictly 
   forbidden unless prior written permission is obtained from Firstlight Media.  
   ******************************************************************************* */
var flAdsYospace=function(e,t,r){"use strict";var i,n;e.SessionState=void 0,(i=e.SessionState||(e.SessionState={}))[i.PLAYER_READY_WITH_SESSION_MONITOR=0]="PLAYER_READY_WITH_SESSION_MONITOR",i[i.PLAYER_READY_NO_SESSION=1]="PLAYER_READY_NO_SESSION",i[i.SESSION_ACTIVE_WITH_ANALYTICS=2]="SESSION_ACTIVE_WITH_ANALYTICS",i[i.SESSION_ACTIVE_NO_ANALYTICS=3]="SESSION_ACTIVE_NO_ANALYTICS",i[i.SESSION_INACTIVE=4]="SESSION_INACTIVE",e.PlaybackMode=void 0,(n=e.PlaybackMode||(e.PlaybackMode={}))[n.Live=0]="Live",n[n.LiveRestart=1]="LiveRestart",n[n.LiveCatchup=2]="LiveCatchup",n[n.Vod=3]="Vod";var a,o=function(){function e(){}return e.setLogger=function(t){e.logger=t},e.debug=function(t){e.logger.debug(t)},e.error=function(t){e.logger.error(t)},e.info=function(t){e.logger.info(t)},e.trace=function(t){e.logger.log(t)},e.warn=function(t){e.logger.warn(t)},e}(),s=Object.freeze({SESSION_INIT_FAILURE:1281}),l=function(){function e(e,r,i){this.yospaceSDK=r,this.adPlaybackPolicy=e,this.playbackMode=null,this.internalPlayer=void 0,this.logger=i||t.createLogger(t.LoggerLevel.OFF,"FL_YOSPACE_PLAYBACK_POLICY")}return e.prototype.setPlaybackMode=function(e){this.playbackMode=e},e.prototype.setPlayer=function(e){this.internalPlayer=e},e.prototype.canChangeVolume=function(){return!0},e.prototype.canClickThrough=function(){return!0},e.prototype.canPause=function(){return this.playbackMode!==this.yospaceSDK.PlaybackMode.LIVE},e.prototype.canResize=function(){return!0},e.prototype.canResizeCreative=function(){return!0},e.prototype.canSkip=function(e,t,r){if(this.playbackMode!==this.yospaceSDK.PlaybackMode.LIVE)return-1;var i=this.isInAdvert(e,t);if(!i)return-1;var n=i.getSkipOffset();return-1===n?-1:(i.isActive()?n>=0&&(n=Math.max(0,i.getStart()+n-e)):n=0,n)},e.prototype.canStop=function(){return!0},e.prototype.closestActiveBreakPriorTo=function(e,t){for(var r=null,i=0;i<t.length;++i){var n=t[i];n.getStart()+n.getDuration()<e&&n.isActive()&&(r=n)}return r},e.prototype.didSeek=function(e,t,r){this.logger.log("[AD POLICY] Did seek from "+e+" to "+t,r)},e.prototype.isInAdvert=function(e,t){for(var r=0;r<t.length;++r){var i=t[r];if(i.getStart()<=e&&e<i.getStart()+i.getDuration())for(var n=0;n<i.getAdverts.length;++n){var a=i.getAdverts()[n];if(a.getStart()<=e&&e<a.getStart()+a.getDuration())return a}}return null},e.prototype.didSkip=function(e,t,r){this.logger.log("[AD POLICY] Did skip from "+e+" to "+t,r)},e.prototype.setInactiveAllAdBreaksBetween=function(e,t,r){for(var i=0;i<r.length;++i){var n=r[i];n.isActive()&&n.getStart()>=e&&n.getStart()+n.getDuration()<=t&&n.setInactive()}},e.prototype.willSeekTo=function(e,t){return this.playbackMode===this.yospaceSDK.PlaybackMode.LIVE||this.internalPlayer&&this.internalPlayer.currentTime?e:this.initialSeekPosition(e,t)},e.prototype.evaluateSeek=function(e){if(this.internalPlayer){if(this.adBreakQueueToPlay&&this.adBreakQueueToPlay.length){var t=this.adBreakQueueToPlay[0].getStart();return this.adBreakQueueToPlay.splice(0,1),void this.internalPlayer.seek(this.getPlayheadPositionWithoutAds(t,e))}this.destinationPlayhead&&(this.internalPlayer.seek(this.getPlayheadPositionWithoutAds(this.destinationPlayhead,e)/1e3),this.destinationPlayhead=void 0)}},e.prototype.initialSeekPosition=function(e,t){if(!t.length)return e;var i=this.getAdBreaks(0,e,t);if(!i.length)return e;var n=i.filter((function(e){return"midroll"===e.getPosition()}));switch(this.adPlaybackPolicy.autoSeekMode){case r.PlaybackAutoSeekMode.AUTO_SEEK_SKIP_ALL:return e;case r.PlaybackAutoSeekMode.AUTO_SEEK_PLAY_PREROLL:return 0===i[0].getStart()?(this.destinationPlayhead=e,i[0].getStart()):e;case r.PlaybackAutoSeekMode.AUTO_SEEK_PLAY_MIDROLL:return this.handleAutoSeekPlayMidroll(e,n);case r.PlaybackAutoSeekMode.AUTO_SEEK_PLAY_ALL:var a=0===i[0].getStart()?i[0]:void 0;return a?(this.handleAutoSeekPlayAllOnPrerollAdBreak(n),this.destinationPlayhead=e,a.getStart()):this.handleAutoSeekPlayAllOnNoPrerollAdBreak(e,n)}return e},e.prototype.handleAutoSeekPlayMidroll=function(e,t){switch(this.adPlaybackPolicy.fastForwardMode){case r.PlaybackFastForwardMode.TRICK_FW_PLAY_FIRST:return t.length?(this.destinationPlayhead=e,t[0].getStart()):e;case r.PlaybackFastForwardMode.TRICK_FW_PLAY_LAST:return t.length?(this.destinationPlayhead=e,t[t.length-1].getStart()):e;default:if(t.length){this.destinationPlayhead=e;var i=t.splice(0,1)[0];if(this.adBreakQueueToPlay=t,i)return i.getStart()}return e}},e.prototype.handleAutoSeekPlayAllOnPrerollAdBreak=function(e){switch(this.adPlaybackPolicy.fastForwardMode){case r.PlaybackFastForwardMode.TRICK_FW_PLAY_FIRST:var t=e[0];this.adBreakQueueToPlay=[t];break;case r.PlaybackFastForwardMode.TRICK_FW_PLAY_LAST:var i=e[e.length-1];this.adBreakQueueToPlay=[i];break;default:this.adBreakQueueToPlay=e}},e.prototype.handleAutoSeekPlayAllOnNoPrerollAdBreak=function(e,t){switch(this.adPlaybackPolicy.fastForwardMode){case r.PlaybackFastForwardMode.TRICK_FW_PLAY_FIRST:var i=t[0];return this.destinationPlayhead=e,i.getStart();case r.PlaybackFastForwardMode.TRICK_FW_PLAY_LAST:var n=t[t.length-1];return this.destinationPlayhead=e,n.getStart();default:i=t[0];return this.destinationPlayhead=e,t.splice(0,1),this.adBreakQueueToPlay=t,i.getStart()}},e.prototype.getPlayheadPositionWithoutAds=function(e,t){var r=t.filter((function(t){return t.getStart()<e})).map((function(e){return e.getDuration()})).reduce((function(e,t){return e+t}));return e-r},e.prototype.getAdBreaks=function(e,t,r,i){var n=[];return r.forEach((function(r){(r.getDuration()>0&&i&&i.includes(r.getPosition())&&r.getStart()>=e&&r.getStart()<=t||r.getDuration()>0&&(0===r.getStart()||r.getStart()>=e&&r.getStart()<=t))&&n.push(r)})),n},e}(),c=function(){function i(e,r){this.deferred_=new t.UtilFactory.Deferred,this.createSessionError=function(e,r){var i=e?t.createError(e,r):void 0;return t.createError(s.SESSION_INIT_FAILURE|t.ErrorCodes.ERROR_CATEGORY_MASK_THIRDPARTY,r,i)},this.yospaceSDK=e,this.logger=r||t.createLogger(t.LoggerLevel.OFF,"FL_YOSPACE_SESSION"),this.sessionEventListener=this.sessionEventListener.bind(this)}return i.prototype.initialize=function(e,i){if(this.deferred_=new t.UtilFactory.Deferred,this.initializationData=e,i)this.internalAdsPlaybackPolicy=new l(i,this.yospaceSDK,this.logger);else{var n={fastForwardMode:r.PlaybackFastForwardMode.TRICK_FW_PLAY_ALL,rewindMode:r.PlaybackRewindMode.TRICK_RW_PLAY_ALL,autoSeekMode:r.PlaybackAutoSeekMode.AUTO_SEEK_PLAY_PREROLL,repeatMode:r.PlaybackRepeatedMode.REPEAT_ALWAYS_PLAY,interruptMode:r.PlaybackInterruptedMode.INTERRUPT_RESUME};this.internalAdsPlaybackPolicy=new l(n,this.yospaceSDK,this.logger)}return this.initYospaceSession(),this.deferred_.promise},i.prototype.shutdown=function(){this.internalSession&&(this.internalSession.shutdown(),this.internalSession=void 0)},i.prototype.initYospaceSession=function(){var t=new this.yospaceSDK.SessionProperties;if(t.userAgent=this.initializationData.userAgent?this.initializationData.userAgent:"FL_YOSPACE_ADS_PLAYER",t.allowCorsForAnalytics=this.initializationData.allowCorsForAnalytics,this.initializationData.timeout&&t.setRequestTimeout(this.initializationData.timeout),o.setLogger(this.logger),this.yospaceSDK.YoLog.setLogger(o),this.yospaceSDK.YoLog.setDebugFlags(this.yospaceSDK.DEBUG_ALL),this.initializationData)switch(this.initializationData.playbackMode){case e.PlaybackMode.Live:case e.PlaybackMode.LiveRestart:this.yospaceSDK.SessionLive.create(this.initializationData.contentURL,t,this.sessionEventListener);break;case e.PlaybackMode.LiveCatchup:case e.PlaybackMode.Vod:this.yospaceSDK.SessionVOD.create(this.initializationData.contentURL,t,this.sessionEventListener)}},i.prototype.sessionEventListener=function(e){switch(this.internalSession=e.getPayload(),this.internalSession.getSessionResult()){case this.yospaceSDK.SessionResult.INITIALISED:this.session instanceof this.yospaceSDK.SessionVOD?(this.internalAdsPlaybackPolicy&&this.internalSession.setPlaybackPolicyHandler(this.internalAdsPlaybackPolicy),this.logger.log("VOD Session playback URL: "+this.session.playbackUrl),this.deferred_.resolve(this.session.playbackUrl)):this.session instanceof this.yospaceSDK.SessionLive&&(this.logger.info("Live Session playback URL: "+this.session.playbackUrl),this.deferred_.resolve(this.session.playbackUrl));break;case this.yospaceSDK.SessionResult.NOT_INITIALISED:var t="Session initialization failed: "+this.yospaceSDK.SessionResult.NOT_INITIALISED;this.logger.warn(t);var r=this.createSessionError(this.internalSession.getResultCode(),t);this.deferred_.reject(r);break;case this.yospaceSDK.SessionResult.NO_ANALYTICS:t="Session initialization failed: "+this.yospaceSDK.SessionResult.NO_ANALYTICS;this.logger.warn(t);r=this.createSessionError(this.internalSession.getResultCode(),t);this.deferred_.reject(r);break;case this.yospaceSDK.SessionResult.FAILED:t="Session initialization failed: "+this.yospaceSDK.SessionResult.FAILED;this.logger.warn(t);r=this.createSessionError(this.internalSession.getResultCode(),t);this.deferred_.reject(r)}},Object.defineProperty(i.prototype,"session",{get:function(){return this.internalSession},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"adsPlaybackPolicy",{get:function(){return this.internalAdsPlaybackPolicy},enumerable:!1,configurable:!0}),i.prototype.attachPlayerToPolicyHandler=function(e){this.internalAdsPlaybackPolicy&&this.internalAdsPlaybackPolicy.setPlayer(e)},i.prototype.evaluateSeek=function(){this.internalAdsPlaybackPolicy&&this.internalAdsPlaybackPolicy.evaluateSeek(this.internalSession.getAdBreaksByType(this.yospaceSDK.BreakType.LINEAR))},i}(),u=function(){function e(){}return e.createYospaceAdsSession=function(e,t){return new c(e,t)},e}(),d=function(){return d=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},d.apply(this,arguments)};!function(e){e.YMID="YMID",e.YSEQ="YSEQ",e.YTYP="YTYP",e.YDUR="YDUR",e.YCSP="YCSP"}(a||(a={}));var p,y=function(){function e(e,t){this.logger=t,this.yospaceSDK=e}return e.prototype.createTimedMetadataFromEmsgEvent=function(e,t){var r,i,n,o,s=this;return e.metaTags.forEach((function(e){if(s.logger.log("metaTag",e),e.schemeIdUri.toUpperCase()==="urn:yospace:a:id3:2016".toUpperCase()){var t=s.bytesToString(e.extendedAttributes);s.logger.log("emsgData",t),t.split(",").forEach((function(e){var t=e.split("=");switch(t[0]){case a.YMID:r=t[1];break;case a.YSEQ:i=t[1];break;case a.YTYP:n=t[1];break;case a.YDUR:o=t[1]}}))}})),void 0!==r&&void 0!==i&&void 0!==n&&void 0!==o?this.yospaceSDK.TimedMetadata.createFromMetadata(r,i,n,o,t):null},e.prototype.createTimedMetadataFromMetadataEvent=function(e,t){var r=e.payload;return this.logger.log("ID3 Tag Metadata",e),this.logger.log("ID3 Tag Metadata payload",e.payload),r.key===a.YMID||r.key===a.YSEQ||r.key===a.YTYP||r.key===a.YDUR?this.processID3Data(e,t):this.handleInvalidMetadata(e),null},e.prototype.bytesToString=function(e,t){void 0===t&&(t=0);for(var r="",i=t;i<e.length;i++)r+=String.fromCharCode(e[i]);return r},e.prototype.setID3Tag=function(e){this.id3={startTime:e.startTime}},e.prototype.processID3Data=function(e,t){var r=e.payload;if(this.id3&&this.id3.hasOwnProperty("startTime")){if(this.id3.startTime!==e.startTime){if(void 0!==this.id3.YMID&&void 0!==this.id3.YSEQ&&void 0!==this.id3.YTYP&&void 0!==this.id3.YDUR)return this.createId3Metadata(e,t);this.logger.warn("The last ID3 tag could not be completed",e),this.setID3Tag(e)}}else this.setID3Tag(e);this.id3[r.key]=this.bytesToString(r.data,1)},e.prototype.createId3Metadata=function(e,t){var r=this.yospaceSDK.TimedMetadata.createFromMetadata(this.id3.YMID,this.id3.YSEQ,this.id3.YTYP,this.id3.YDUR,t);return this.logger.log("ID3 tag",this.id3),this.setID3Tag(e),this.id3[e.payload.key]=this.bytesToString(e.payload.data,1),r},e.prototype.handleInvalidMetadata=function(e){this.logger.warn("ID3 Tag Metadata may contain EXT-X-DATERANGE tag"),this.logger.warn("ID3 Tag Metadata are not processed properly",e)},e}(),g=function(e,t,i,n){var a=this;this.queue=[],this.onSeek=function(){a.logger.log("Flushing the timedmetadata queue"),a.queue=[]},this.onProgress=function(e){a.findCurrentEvents().forEach((function(t){return a.publishEvent(t,e)}))},this.enqueue=function(e){a.queue.push(e)},this.dequeue=function(){return a.queue.shift()},this.publishEvent=function(e,t){var i=void 0;if("emsg"===e.type){var n=new r.MetadataInformation([a.buildMetaTag(e)]);i=a.sessionHandler.createTimedMetadataFromEmsgEvent(n,t)}else"metadata"===e.type&&(i=a.sessionHandler.createTimedMetadataFromMetadataEvent(e,t));null!==i&&a.session.onTimedMetadata(i)},this.next=function(){return a.queue[0]},this.getPlayheadPosition=function(){return a.player.currentTime},this.findCurrentEvents=function(){for(var e=[],t=a.next();t&&t.startTime<=a.getPlayheadPosition();)e.push(a.dequeue()),t=a.next();return e},this.buildMetaTag=function(e){return{type:r.FrameType.META_TAG_EMSG_TYPE,id:e.id,extendedAttributes:e.messageData,schemeIdUri:e.schemeIdUri}},this.player=e,this.session=t,this.yospaceSDK=i,this.sessionHandler=new y(i,n),this.logger=n};function h(e,t){if(!e)return 0;var r=e.getAdBreaksByType(t).filter((function(e){return e.getAdverts().length>0}));return r.map((function(e){return e.getDuration()})).reduce((function(e,t){return e+t}),0)}function f(e,t,r){return t?e+=t.getAdBreaksByType(r).filter((function(t){return 0===t.getStart()||t.getStart()<e})).map((function(e){return e.getDuration()})).reduce((function(e,t){return e+t}),0):e}!function(e){e.ADSYSTEM="AdSystem",e.ADTITLE="AdTitle",e.ADSERVINGID="AdServingId",e.CATEGORY="Category",e.DESCRIPTION="Description",e.ADVERTISER="Advertiser",e.PRICING="Pricing",e.SURVEY="Survey",e.EXPIRES="Expires"}(p||(p={}));var A="apiFramework";function S(e,t,r){return{get adID(){return e.getIdentifier()||" "},get sequence(){return e.getSequence()},get adStartTimeOffsetMs(){return e.getStart()},get durationMs(){return e.getDuration()},get remainingTimeMs(){return e.getRemainingTime(1e3*t.currentTime)},get isSkippable(){return e.getSkipOffset()>-1},get skipOffsetMs(){return e.getSkipOffset()},get isFiller(){return e.isFiller()},get adBreakInfo(){return r},get vastProperties(){return e?function(e){var t=e.getLinearCreative(),r={creativeId:t?t.getCreativeIdentifier():void 0},i=e.properties;if(!i)return r;return Object.keys(i).forEach((function(e){switch(i[e].name){case p.ADSYSTEM:r.adSystem=i[e].value;break;case p.ADTITLE:r.adTitle=i[e].value;break;case p.ADSERVINGID:r.adServingId=i[e].value;break;case p.CATEGORY:r.category=i[e].value;break;case p.DESCRIPTION:r.description=i[e].value;break;case p.ADVERTISER:r.advertiser=i[e].value;break;case p.SURVEY:r.survey=i[e].value;break;case p.PRICING:r.pricing=i[e].value;break;case p.EXPIRES:r.expires=i[e].value}})),r}(e):void 0}}}var E=function(){function e(e,i,n,a){var o=this;(this.eventEmitter=t.createEventEmitter(),this.internalPlayerContext=r.PlayerContext.MAIN,this.midrollAdBreakIndex=0,this.isPlaybackPaused=!1,this.isPlayerSeeking=!1,this.isPlayerBuffering=!1,this.activeAdBreakInfo=void 0,this.activeAdInfo=void 0,this.shouldReportAdProgress=!1,this.currentAdStartTime=void 0,this.currentAdEndTime=void 0,this.isAdVerificationStarted=!1,this.vodSessionAdsDuration=0,this.initialize=function(){o.initializeBySessionType(),o.subscribeToInternalPlayerEvents(),o.session?(o.session.addAnalyticObserver({onAdvertBreakStart:function(e){o.logger.log("onAdvertBreakStart",e);var t=r.AdTrackingEvent.AD_BREAK_STARTED_EVENT;if(o.logger.log("trackingEvent:",t),o.internalPlayerContext=r.PlayerContext.AD,o.eventEmitter.publish("playercontextchanged",o.internalPlayerContext),null!==e){var i=function(e){switch(e){case"preroll":return r.AdContentTimePosition.PREROLL;case"midroll":return r.AdContentTimePosition.MIDROLL;case"postroll":return r.AdContentTimePosition.POSTROLL;default:return r.AdContentTimePosition.UNKNOWN}}(e.getPosition()),n=o.session instanceof o.yospaceSDK.SessionVOD?o.getAdBreakIndex(i):r.VALUE_UNKNOWN;o.activeAdBreakInfo=o.toAdBreakInfo(e,i,n,o.player)}o.logger.log("ActiveAdBreakInfo",o.activeAdBreakInfo),o.eventEmitter.publish(r.AdEvent.ADVERT_BREAK_START,o.activeAdBreakInfo)},onAdvertBreakEnd:function(){o.logger.log("onAdvertBreakEnd");var e=r.AdTrackingEvent.AD_BREAK_ENDED_EVENT;o.logger.log("trackingEvent:",e),o.yospaceSession.evaluateSeek(),o.internalPlayerContext=r.PlayerContext.MAIN,o.eventEmitter.publish("playercontextchanged",o.internalPlayerContext),o.eventEmitter.publish(r.AdEvent.ADVERT_BREAK_END,o.activeAdBreakInfo),o.activeAdBreakInfo=void 0},onAdvertStart:function(e){o.logger.log("onAdvertStart",e);var t=r.AdTrackingEvent.AD_STARTED_EVENT;o.logger.log("trackingEvent:",t),o.activeAdInfo=o.toAdInfo(e,o.player,o.activeAdBreakInfo),o.shouldReportAdProgress=!0,o.currentAdStartTime=e.getStart(),o.currentAdEndTime=e.getStart()+e.getDuration(),o.logger.log("ActiveAdInfo",o.activeAdInfo),o.eventEmitter.publish(r.AdEvent.ADVERT_START,o.activeAdInfo),o.onAdVerificationStart(e)},onAdvertEnd:function(){o.logger.log("onAdvertEnd");var e=r.AdTrackingEvent.AD_ENDED_EVENT;o.logger.log("trackingEvent:",e),o.shouldReportAdProgress=!1,o.currentAdStartTime=void 0,o.currentAdEndTime=void 0,o.eventEmitter.publish(r.AdEvent.ADVERT_END,o.activeAdInfo),o.onAdVerificationEnd()},onAnalyticUpdate:function(){},onTrackingEvent:function(e){var t=o.toAdTrackingEvent(e);o.logger.log("trackingEvent:",t),o.onAdTrackingEvent(t)}}),o.session&&o.session instanceof o.yospaceSDK.SessionVOD&&(o.vodSessionAdsDuration=h(o.session,o.yospaceSDK.BreakType.LINEAR),o.logger.log("VOD session duration "+o.vodSessionAdsDuration))):o.logger.warn("Session is invalid. Please ensure a valid YospaceAdsSession instance is passed via YospaceAdsPlayerFactory.createYospaceAdsPlayer")},this.initializeBySessionType=function(){if(o.session&&o.session instanceof o.yospaceSDK.SessionLive)o.timedMetadataHandler=new g(o,o.session,o.yospaceSDK,o.logger);else if(o.session&&o.session instanceof o.yospaceSDK.SessionVOD&&(o.vodSessionAdsDuration=h(o.session,o.yospaceSDK.BreakType.LINEAR),o.player.playbackOptions&&o.player.playbackOptions.initialPlaybackTime)){var e=f(1e3*o.player.playbackOptions.initialPlaybackTime,o.session,o.yospaceSDK.BreakType.LINEAR);e=o.session.willSeekTo(e),o.logger.log("[AD POLICY] overriding initial playback time",e),o.player.setPlaybackOptions(d(d({},o.player.playbackOptions),{initialPlaybackTime:e/1e3}))}},this.playbackStateChanged_=function(e){switch(o.logger.log("onPlaybackStateChanged",e),e){case r.PLAYBACK_STATES.IDLE:case r.PLAYBACK_STATES.LOADING:break;case r.PLAYBACK_STATES.LOADED:var t=o.session.getAdBreaksByType(o.yospaceSDK.BreakType.LINEAR).map((function(e){return e.getStart()}));t&&t.length&&o.eventEmitter.publish("adcuepoints",t);break;case r.PLAYBACK_STATES.STARTED:o.isPlaybackPaused?(o.logger.log("onPlayerEvent -> PlayerEvent.RESUME with playhead position"),o.session.onPlayerEvent(o.yospaceSDK.PlayerEvent.RESUME),o.isPlaybackPaused=!1):(o.logger.log("onPlayerEvent -> PlayerEvent.START with playhead position"),o.session.onPlayerEvent(o.yospaceSDK.PlayerEvent.START));break;case r.PLAYBACK_STATES.PAUSED:o.logger.log("onPlayerEvent -> PlayerEvent.PAUSE with playhead position"),o.isPlaybackPaused=!0,o.session.onPlayerEvent(o.yospaceSDK.PlayerEvent.PAUSE);break;case r.PLAYBACK_STATES.STOPPED:o.logger.log("onPlayerEvent -> PlayerEvent.STOP with playhead position"),o.session.onPlayerEvent(o.yospaceSDK.PlayerEvent.STOP),o.releaseSession()}},this.onSeekingStateChanged_=function(e){switch(o.logger.log("onSeekingStateChanged",e),e){case r.SEEKING_STATES.ACTIVE:o.isPlayerSeeking=!0;break;case r.SEEKING_STATES.INACTIVE:o.isPlayerSeeking&&(o.session.onPlayerEvent(o.yospaceSDK.PlayerEvent.SEEK,1e3*o.player.currentTime),o.isPlayerSeeking=!1,o.timedMetadataHandler&&o.timedMetadataHandler.onSeek())}},this.onBufferingStateChanged_=function(e){switch(o.logger.log("onBufferingStateChanged",e),e){case r.BUFFERING_STATES.ACTIVE:o.isPlayerBuffering=!0,o.session.onPlayerEvent(o.yospaceSDK.PlayerEvent.STALL);break;case r.BUFFERING_STATES.INACTIVE:o.isPlayerBuffering&&(o.session.onPlayerEvent(o.yospaceSDK.PlayerEvent.CONTINUE),o.isPlayerBuffering=!1)}},this.onProgressUpdate_=function(){if(o.activeAdInfo&&o.shouldReportAdProgress&&void 0!==o.currentAdStartTime&&void 0!==o.currentAdEndTime&&o.player.currentTime<=o.currentAdEndTime){var e=1e3*o.player.currentTime-o.currentAdStartTime;o.eventEmitter.publish("adprogressupdate",o.activeAdInfo,e)}o.session.onPlayheadUpdate(1e3*o.player.currentTime),o.timedMetadataHandler&&o.timedMetadataHandler.onProgress(1e3*o.player.currentTime)},this.onAborted_=function(){o.logger.log("onAborted")},this.onContentLoaded_=function(){var e=[];o.session.getAdBreaksByType(o.yospaceSDK.BreakType.LINEAR).forEach((function(t){if(t){var i=o.toAdContentTimePosition(t.getPosition()),n=o.session instanceof o.yospaceSDK.SessionVOD?o.getAdBreakIndex(i):r.VALUE_UNKNOWN,a=o.toAdBreakInfo(t,i,n,o.player);t.getAdverts().map((function(t){var r=o.toAdInfo(t,o.player,a);e.push(r)}))}o.eventEmitter.publish("adbreaks",e)}))},this.onTracksChanged_=function(){o.logger.log("onTracksChanged")},this.onTimedMetadata_=function(e){o.timedMetadataHandler&&o.timedMetadataHandler.enqueue(e)},this.onError_=function(e){o.activeAdBreakInfo&&o.eventEmitter.publish("aderror",e),o.releaseSession()},this.subscribeToInternalPlayerEvents=function(){o.player.subscribe("playbackstatechanged",o.playbackStateChanged_),o.player.subscribe("seekingstatechanged",o.onSeekingStateChanged_),o.player.subscribe("bufferingstatechanged",o.onBufferingStateChanged_),o.player.subscribe("progressupdate",o.onProgressUpdate_),o.player.subscribe("aborted",o.onAborted_),o.player.subscribe("contentloaded",o.onContentLoaded_),o.player.subscribe("trackschanged",o.onTracksChanged_),o.player.subscribe("timedmetadata",o.onTimedMetadata_),o.player.subscribe("error",o.onError_)},this.unsubscribeFromInternalPlayerEvents=function(){o.player.unsubscribe("playbackstatechanged",o.playbackStateChanged_),o.player.unsubscribe("seekingstatechanged",o.onSeekingStateChanged_),o.player.unsubscribe("bufferingstatechanged",o.onBufferingStateChanged_),o.player.unsubscribe("progressupdate",o.onProgressUpdate_),o.player.unsubscribe("aborted",o.onAborted_),o.player.unsubscribe("contentloaded",o.onContentLoaded_),o.player.unsubscribe("trackschanged",o.onTracksChanged_),o.player.unsubscribe("timedmetadata",o.onTimedMetadata_),o.player.unsubscribe("error")},this.releaseSession=function(){o.midrollAdBreakIndex=0,o.session&&(o.session.shutdown(),o.session=void 0),o.unsubscribeFromInternalPlayerEvents()},this.toAdContentTimePosition=function(e){switch(e){case"preroll":return r.AdContentTimePosition.PREROLL;case"midroll":return r.AdContentTimePosition.MIDROLL;case"postroll":return r.AdContentTimePosition.POSTROLL;default:return r.AdContentTimePosition.UNKNOWN}},this.getAdBreakIndex=function(e){switch(e){case r.AdContentTimePosition.PREROLL:return 0;case r.AdContentTimePosition.MIDROLL:return++o.midrollAdBreakIndex;case r.AdContentTimePosition.POSTROLL:return-1;default:return r.VALUE_UNKNOWN}},this.toAdBreakInfo=function(e,t,r,i){return function(e,t,r,i){return{get adBreakID(){return e.getIdentifier()||" "},get contentTimePosition(){return t},get adSequencePosition(){return 1},get adBreakStartTimeOffsetMs(){return e.getStart()},get remainingTimeMs(){return e.getRemainingTime(1e3*i.currentTime)},get durationMs(){return e.getDuration()},get totalAds(){return e.getAdverts().length},get adBreakIndex(){return r}}}(e,t,r,i)},this.toAdInfo=function(e,t,r){return S(e,t,r)},this.toAdTrackingEvent=function(e){switch(e){case"firstQuartile":return r.AdTrackingEvent.AD_FIRST_QUARTILE_EVENT;case"midpoint":return r.AdTrackingEvent.AD_MIDPOINT_EVENT;case"thirdQuartile":return r.AdTrackingEvent.AD_THIRD_QUARTILE_EVENT;case"pause":return r.AdTrackingEvent.AD_PAUSED_EVENT;case"resume":return r.AdTrackingEvent.AD_RESUMED_EVENT;case"mute":return r.AdTrackingEvent.AD_MUTED_EVENT;case"unmute":return r.AdTrackingEvent.AD_UNMUTED_EVENT;case"skip":return r.AdTrackingEvent.AD_SKIPPED_EVENT;case"playerExpand":return r.AdTrackingEvent.AD_PLAYER_EXPANDED_EVENT;case"playerCollapse":return r.AdTrackingEvent.AD_PLAYER_COLLAPSED_EVENT;case"adExpand":return r.AdTrackingEvent.AD_EXPANDED_EVENT;case"adCollapse":return r.AdTrackingEvent.AD_COLLAPSED_EVENT;default:return r.AdTrackingEvent.AD_UNKNOWN_EVENT}},this.onAdVerificationStart=function(e){if(o.logger.log("Open Measurement Ad verification: start"),e.isActive())if(e.isFiller())o.logger.log("Open Measurement Ad verification: advert is a filler");else{var t=[];e.getAdVerifications().forEach((function(e){var r=e.getVendor(),i=e.getParameters(),n=e.getResources(),a=[];n.forEach((function(e){var t={name:e.getName(),value:e.getValue(),attributes:e.getAttributes()};a.push(t)}));var o={verificationResources:a,verificationParameters:i,vendorKey:r};t.push(o)})),t.length&&(o.isAdVerificationStarted=!0,o.eventEmitter.publish(r.AdEvent.ADVERT_VERIFICATION_START,e,t))}else o.logger.log("Open Measurement Ad verification: advert is not active")},this.logger=a||t.createLogger(t.LoggerLevel.OFF,"FL_YOSPACE_PLAYER"),this.player=e,this.session=i.session,this.yospaceSession=i,this.yospaceSDK=n,this.session&&this.session instanceof this.yospaceSDK.SessionVOD)&&i.attachPlayerToPolicyHandler(this);this.initialize()}return Object.defineProperty(e.prototype,"playerContext",{get:function(){return this.internalPlayerContext},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"availableBitrates",{get:function(){return this.player.availableBitrates},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentEpochTime",{get:function(){return this.player.currentEpochTime},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentTime",{get:function(){if(this.player.isLive)return this.player.currentTime;var e,t,r,i=(e=1e3*this.player.currentTime,t=this.session,r=this.yospaceSDK.BreakType.LINEAR,t?function(e,t){return void 0===t&&(t=[]),t.filter((function(t){return t.getStart()+t.getDuration()<e})).map((function(e){return e.getDuration()})).reduce((function(e,t){return e+t}),0)+t.filter((function(t){return function(e,t){return t.getStart()<=e&&e<t.getStart()+t.getDuration()}(e,t)})).map((function(t){return e-t.getStart()})).reduce((function(e,t){return e+t}),0)}(e,t.getAdBreaksByType(r).filter((function(e){return e.getAdverts().length>0}))):0),n=Number(this.player.currentTime.toFixed(6))-Number((i/1e3).toFixed(6));return n<0?0:n},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"duration",{get:function(){return!this.player.isLive&&this.session&&this.session.getAdBreaksByType(this.yospaceSDK.BreakType.LINEAR).length?(1e3*this.player.duration-this.vodSessionAdsDuration)/1e3:this.player.duration},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"internalPlayerName",{get:function(){return this.player.internalPlayerName},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"internalPlayerVersion",{get:function(){return this.player.internalPlayerVersion},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isBuffering",{get:function(){return this.player.isBuffering},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isLive",{get:function(){return this.player.isLive},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isMute",{get:function(){return this.player.isMute},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"playbackOptions",{get:function(){return this.player.playbackOptions},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isSeeking",{get:function(){return this.player.isSeeking},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"maxBitrate",{get:function(){return this.player.maxBitrate},set:function(e){this.player.maxBitrate=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"minBitrate",{get:function(){return this.player.minBitrate},set:function(e){this.player.minBitrate=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"playbackRate",{get:function(){return this.player.playbackRate},set:function(e){this.player.playbackRate=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"playbackStatistics",{get:function(){return this.player.playbackStatistics},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"playerState",{get:function(){return this.player.playerState},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rawLibrary",{get:function(){return this.player.rawLibrary},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rawPlayer",{get:function(){return this.player.rawPlayer},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"remainingTime",{get:function(){return 0},enumerable:!1,configurable:!0}),e.prototype.abort=function(e){this.player.abort(e)},e.prototype.send=function(e,t,r){this.player.send(e,t,r)},e.prototype.currentOffsetFromLiveEdge=function(){return this.player.currentOffsetFromLiveEdge()},e.prototype.discardAdBreak=function(){},e.prototype.resize=function(e,t,r){},e.prototype.getActiveTracks=function(){return this.player.getActiveTracks()},e.prototype.getAllTracks=function(){return this.player.getAllTracks()},e.prototype.getCuePoints=function(){return this.session.getPlaybackMode()===this.yospaceSDK.PlaybackMode.VOD?this.session.getAdBreaksByType(this.yospaceSDK.BreakType.LINEAR).map((function(e){return e.getStart()})):[]},e.prototype.load=function(){this.player.load()},e.prototype.muteOrUnmute=function(){this.player.muteOrUnmute&&this.player.muteOrUnmute()},e.prototype.pause=function(){this.player.pause()},e.prototype.play=function(){this.player.play()},e.prototype.seek=function(e){!this.player.isLive&&this.session&&this.session.getAdBreaksByType(this.yospaceSDK.BreakType.LINEAR).length?this.player.seek(this.session.willSeekTo(f(e>=0?1e3*e:0,this.session,this.yospaceSDK.BreakType.LINEAR))/1e3):this.player.seek(e)},e.prototype.seekToLiveEdge=function(){this.player.seekToLiveEdge()},e.prototype.seekableRange=function(){return this.player.isLive?this.player.seekableRange():{start:0,end:this.duration}},e.prototype.selectTrack=function(e){this.player.selectTrack(e)},e.prototype.setRequestInterceptor=function(e){this.player.setRequestInterceptor(e)},e.prototype.setResponseInterceptor=function(e){this.player.setResponseInterceptor(e)},e.prototype.getThumbnail=function(e){return this.player.getThumbnail(e)},e.prototype.skipAd=function(){},e.prototype.stop=function(){return this.player.stop()},e.prototype.accessFunctionHandler=function(e){this.player.accessFunctionHandler(e)},e.prototype.subscribe=function(e,t){this.eventEmitter.subscribe(e,t),this.player.subscribe(e,t)},e.prototype.unsubscribe=function(e,t){this.eventEmitter.unsubscribe(e,t),this.player.unsubscribe(e,t)},e.prototype.onAdVerificationEnd=function(){this.logger.log("Open Measurement Ad verification: end"),this.isAdVerificationStarted&&(this.isAdVerificationStarted=!1,this.eventEmitter.publish(r.AdEvent.ADVERT_VERIFICATION_END))},e.prototype.onAdTrackingEvent=function(e){this.logger.log('Open Measurement Ad verification: ad event "'+e+'"'),this.eventEmitter.publish(r.AdEvent.ADVERT_TRACKING_EVENT,e)},e.prototype.setPlaybackOptions=function(e){this.player.setPlaybackOptions(e)},e}(),P=function(){function e(){}return e.createYospaceAdsPlayer=function(e,t,r,i){return new E(e,t,r,i)},e}();return e.YospaceAdsPlayerFactory=P,e.YospaceAdsSessionFactory=u,e.findJavaScriptResourceURL=function(e){var t=e.verificationResources.filter((function(e){return"JavaScriptResource"===e.name})).filter((function(e){return e.attributes.has(A)})).filter((function(e){return"omid"===e.attributes.get(A)}));return t.length?t[0].value:null},e.version="7.0.56",Object.defineProperty(e,"__esModule",{value:!0}),e}({},flFoundation,flPlayerInterface);

