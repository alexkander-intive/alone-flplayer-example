/*! ******************************************************************************* 
   Package Name: fl-conviva
   Generated: 2022-08-24
   Version: 7.0.56

   Copyright (C) Firstlight Media. All rights reserved.  
   
   All information contained herein is, and remains the property of Firstlight Media. 
   The intellectual and technical concepts contained herein are proprietary to 
   Firstlight Media.  

   Dissemination of this information or reproduction of this material is strictly 
   forbidden unless prior written permission is obtained from Firstlight Media.  
   ******************************************************************************* */
var flConviva=function(t,a,e){"use strict";var n;t.AdTechnology=void 0,(n=t.AdTechnology||(t.AdTechnology={})).CLIENT_SIDE="CLIENT_SIDE",n.SERVER_SIDE="SERVER_SIDE";var i=function(){function n(n,i,r,o){var s=this;this.initializationData=n,this.bufferingState=a.BUFFERING_STATES.INACTIVE,this.subscribeToInternalPlayerEvents=function(t){t?(t.subscribe("bufferingstatechanged",s.onBufferingStateChanged),t.subscribe("progressupdate",s.onProgressUpdate),t.subscribe("streamended",s.onStreamEnded),t.subscribe("seekingstatechanged",s.onSeekingStateChanged),t.subscribe("playbackstatechanged",s.onPlaybackStateChanged),t.subscribe("bandwidthchanged",s.onBandwidthChanged),t.subscribe("adbreakstart",s.onAdBreakStart),t.subscribe("adbreakend",s.onAdBreakEnd),t.subscribe("adstart",s.onAdStart),t.subscribe("adend",s.onAdEnd),t.subscribe("adprogressupdate",s.onAdProgressUpdate),t.subscribe("error",s.onError),t.subscribe("aderror",s.onAdError)):s.logger.log("[Conviva][Error] Cannot subscribe to undefined player events")},this.unsubscribeFromInternalPlayerEvents=function(t){t?(t.unsubscribe("bufferingstatechanged",s.onBufferingStateChanged),t.unsubscribe("progressupdate",s.onProgressUpdate),t.unsubscribe("streamended",s.onStreamEnded),t.unsubscribe("seekingstatechanged",s.onSeekingStateChanged),t.unsubscribe("playbackstatechanged",s.onPlaybackStateChanged),t.unsubscribe("bandwidthchanged",s.onBandwidthChanged),t.unsubscribe("adbreakstart",s.onAdBreakStart),t.unsubscribe("adbreakend",s.onAdBreakEnd),t.unsubscribe("adstart",s.onAdStart),t.unsubscribe("adend",s.onAdEnd),t.unsubscribe("adprogressupdate",s.onAdProgressUpdate),t.unsubscribe("error",s.onError),t.unsubscribe("aderror",s.onAdError)):s.logger.log("[Conviva][Error] Cannot unsubscribe from undefined player events")},this.onBufferingStateChanged=function(t){if(s.videoAnalytics)switch(s.logger.log("[Conviva][PlayerEvent] bufferingstatechanged",t),t){case a.BUFFERING_STATES.ACTIVE:s.bufferingState=a.BUFFERING_STATES.ACTIVE,s.reportPlaybackMetric(Conviva.Constants.Playback.PLAYER_STATE,Conviva.Constants.PlayerState.BUFFERING);break;case a.BUFFERING_STATES.INACTIVE:s.bufferingState=a.BUFFERING_STATES.INACTIVE,s.internalPlayer&&s.internalPlayer.playerState===a.PLAYBACK_STATES.PAUSED?s.reportPlaybackMetric(Conviva.Constants.Playback.PLAYER_STATE,Conviva.Constants.PlayerState.PAUSED):s.reportPlaybackMetric(Conviva.Constants.Playback.PLAYER_STATE,Conviva.Constants.PlayerState.PLAYING)}},this.onProgressUpdate=function(){if(s.internalPlayer&&s.internalPlayer.duration){var t={};s.internalPlayer.isLive||(t["Conviva.duration"]=s.internalPlayer.duration),s.videoAnalytics&&Object.keys(t).length&&s.videoAnalytics.setContentInfo(t)}},this.onStreamEnded=function(){s.videoAnalytics&&(s.logger.log("[Conviva][PlayerEvent] streamended"),s.videoAnalytics.reportPlaybackEnded())},this.onSeekingStateChanged=function(t){if(s.videoAnalytics)switch(s.logger.log("[Conviva][PlayerEvent] seekingstatechanged",t),t){case a.SEEKING_STATES.ACTIVE:s.reportPlaybackMetric(Conviva.Constants.Playback.SEEK_STARTED);break;case a.SEEKING_STATES.INACTIVE:s.reportPlaybackMetric(Conviva.Constants.Playback.SEEK_ENDED)}},this.onPlaybackStateChanged=function(t){var e;if(s.videoAnalytics)switch(s.logger.log("[Conviva][PlayerEvent] playbackstatechanged",t),t){case a.PLAYBACK_STATES.LOADING:case a.PLAYBACK_STATES.LOADED:break;case a.PLAYBACK_STATES.STARTED:if(!s.isMainContext(s.internalPlayer))return;s.setContentMetadata(((e={})[Conviva.Constants.IS_LIVE]=s.isLive(s.internalPlayer),e)),s.bufferingState!==a.BUFFERING_STATES.ACTIVE&&s.reportPlaybackMetric(Conviva.Constants.Playback.PLAYER_STATE,Conviva.Constants.PlayerState.PLAYING),s.internalPlayer&&s.internalPlayer.playbackStatistics&&(s.reportPlaybackMetric(Conviva.Constants.Playback.BITRATE,s.internalPlayer.playbackStatistics.variantBitrate/1e3),s.internalPlayer.playbackStatistics.framerate&&s.reportPlaybackMetric(Conviva.Constants.Playback.RENDERED_FRAMERATE,s.internalPlayer.playbackStatistics.framerate));break;case a.PLAYBACK_STATES.PAUSED:if(!s.isMainContext(s.internalPlayer))return;s.reportPlaybackMetric(Conviva.Constants.Playback.PLAYER_STATE,Conviva.Constants.PlayerState.PAUSED);break;case a.PLAYBACK_STATES.STOPPED:s.reportPlaybackMetric(Conviva.Constants.Playback.PLAYER_STATE,Conviva.Constants.PlayerState.STOPPED);break;case a.PLAYBACK_STATES.IDLE:s.videoAnalytics.reportPlaybackEnded(),s.unsubscribeFromInternalPlayerEvents(s.internalPlayer),s.internalPlayer=void 0}},this.onBandwidthChanged=function(){s.videoAnalytics&&(s.internalPlayer&&s.internalPlayer.playbackStatistics?(s.logger.log("[Conviva][PlayerEvent] bandwidthchanged",s.internalPlayer.playbackStatistics.variantBitrate/1e3),s.reportPlaybackMetric(Conviva.Constants.Playback.BITRATE,s.internalPlayer.playbackStatistics.variantBitrate/1e3)):s.logger.log("[Conviva][PlayerEvent] bandwidthchanged - Bitrate is not available"))},this.onAdBreakStart=function(a){s.videoAnalytics&&!s.isAdBreakStartReported&&(s.isAdBreakStartReported=!0,s.isAdBreakEndReported=!1,s.logger.log("[Conviva][PlayerEvent] adbreakstart",a),s.adMetadata&&s.adMetadata.adTechnology===t.AdTechnology.SERVER_SIDE?s.videoAnalytics.reportAdBreakStarted(Conviva.Constants.AdType.SERVER_SIDE,Conviva.Constants.AdPlayer.CONTENT):s.videoAnalytics.reportAdBreakStarted(Conviva.Constants.AdType.CLIENT_SIDE,Conviva.Constants.AdPlayer.SEPARATE))},this.onAdBreakEnd=function(t){s.videoAnalytics&&!s.isAdBreakEndReported&&(s.isAdBreakEndReported=!0,s.isAdBreakStartReported=!1,s.logger.log("[Conviva][PlayerEvent] adbreakend",t),s.videoAnalytics.reportAdBreakEnded())},this.onAdStart=function(t){s.adAnalytics&&(s.logger.log("[Conviva][PlayerEvent] adstart",t),s.adAnalytics.reportAdStarted(s.buildAdMetadata(t)),t.vastProperties&&t.vastProperties.bitrate&&s.adAnalytics.reportAdMetric(Conviva.Constants.Playback.BITRATE,t.vastProperties.bitrate))},this.onAdEnd=function(t){s.adAnalytics&&(s.logger.log("[Conviva][PlayerEvent] adend",t),s.adAnalytics.reportAdEnded())},this.onAdProgressUpdate=function(t,a){s.adAnalytics&&(s.logger.log("[Conviva][PlayerEvent] adprogressupdate",t,a),s.adAnalytics.reportAdMetric(Conviva.Constants.Playback.PLAYER_STATE,Conviva.Constants.PlayerState.PLAYING))},this.onError=function(t){if(t&&s.videoAnalytics){s.logger.log("[Conviva][PlayerEvent] error",t);var a=""+t;t.doesBelongToCategory&&t.doesBelongToCategory(e.ErrorCodes.ERROR_CATEGORY_MASK_SERVER)&&t.internalError?a=t.internalError.errorMessage+" ("+t.internalError.errorCode+")":t.hexErrorCode?a=t.errorMessage+" ("+t.hexErrorCode+")":void 0!==t.errorCode&&(a=t.errorMessage+" ("+t.errorCode+")"),s.videoAnalytics.reportPlaybackError(a,Conviva.Constants.ErrorSeverity.FATAL)}},this.onAdError=function(t){if(t&&s.adAnalytics){s.isAdBreakStartReported||s.onAdBreakStart();var a=JSON.stringify(t);a=t.getMessage()+" ("+t.getErrorCode()+")",s.logger.log("[Conviva][AdEvent] error",t),s.adAnalytics.reportAdFailed(a,s.buildAdMetadata()),s.isAdBreakEndReported||s.onAdBreakEnd()}},this.instanceOfAdComposedPlayer=function(t){return void 0!==t.playerContext},this.isMainContext=function(t){return!t||!s.instanceOfAdComposedPlayer(t)||t.playerContext===a.PlayerContext.MAIN},this.buildAdMetadata=function(a){var e,n,i,r={};return s.adMetadata&&(r["c3.ad.adStitcher"]=null!==(e=s.adMetadata.adStitcher)&&void 0!==e?e:"NA",r["c3.ad.mediaFileApiFramework"]=null!==(n=s.adMetadata.adMediaFileApiFramework)&&void 0!==n?n:"NA",r["c3.ad.isSlate"]=null!==(i=s.adMetadata.isSlate)&&void 0!==i?i:"false",r["c3.ad.technology"]=s.adMetadata.adTechnology&&s.adMetadata.adTechnology===t.AdTechnology.SERVER_SIDE?Conviva.Constants.AdType.SERVER_SIDE:Conviva.Constants.AdType.CLIENT_SIDE),a&&(s.setVastProperties(r,a.vastProperties),r[Conviva.Constants.IS_LIVE]=s.metadata&&s.metadata[Conviva.Constants.IS_LIVE]?s.metadata[Conviva.Constants.IS_LIVE]:s.isLive(s.internalPlayer),r["Conviva.duration"]=a.durationMs?a.durationMs/1e3:0,r["c3.ad.id"]=a.adID,r["c3.ad.position"]=s.toC3AdPosition(a.adBreakInfo),r["c3.ad.firstAdSystem"]=s.toC3AdFirstAdSystem(a),r["c3.ad.firstAdId"]=s.toC3AdFirstAdId(a),r["c3.ad.firstCreativeId"]=s.toC3AdFirstCreavtiveId(a)),s.setAdStreamUrl(r,a),r},this.toC3AdPosition=function(t){if(!t)return Conviva.Constants.AdPosition.PREROLL;switch(t.contentTimePosition){case a.AdContentTimePosition.MIDROLL:return Conviva.Constants.AdPosition.MIDROLL;case a.AdContentTimePosition.POSTROLL:return Conviva.Constants.AdPosition.POSTROLL;case a.AdContentTimePosition.PREROLL:default:return Conviva.Constants.AdPosition.PREROLL}},this.isLive=function(t){return t?t.isLive?Conviva.Constants.StreamType.LIVE:Conviva.Constants.StreamType.VOD:Conviva.Constants.StreamType.UNKNOWN},this.isInitialized=function(){return!!s.videoAnalytics},this.destroy=function(){s.videoAnalytics&&(s.videoAnalytics.release(),s.videoAnalytics=void 0),s.adAnalytics&&(s.adAnalytics.release(),s.adAnalytics=void 0),Conviva.Analytics.release()},this.internalPlayer=void 0,this.isAdBreakStartReported=!1,this.isAdBreakEndReported=!1,this.deviceMetadata=i,this.adPlayerInfo=r,this.logger=o||e.createLogger(e.LoggerLevel.OFF,"FL_CONVIVA_SESSION")}return n.prototype.initialize=function(){var t;if(this.initializationData.debug){if(!this.initializationData.gatewayUrl)return void this.logger.log("[Conviva] Gateway URL is missing. Debug session not initialized.");var a=((t={})[Conviva.Constants.GATEWAY_URL]=this.initializationData.gatewayUrl,t[Conviva.Constants.LOG_LEVEL]=Conviva.Constants.LogLevel.DEBUG,t);Conviva.Analytics.init(this.initializationData.customerKey,null,a)}else Conviva.Analytics.init(this.initializationData.customerKey,null);Conviva.Analytics.setDeviceMetadata(this.deviceMetadata),this.videoAnalytics=Conviva.Analytics.buildVideoAnalytics(),this.adAnalytics=Conviva.Analytics.buildAdAnalytics(this.videoAnalytics),this.adAnalytics.setAdPlayerInfo(this.adPlayerInfo?this.adPlayerInfo:{}),this.logger.log("[Conviva] Session initialized",this.initializationData)},n.prototype.reportPlaybackRequested=function(t,a){this.isInitialized()&&this.videoAnalytics?(this.metadata=t,this.adMetadata=a,this.videoAnalytics.reportPlaybackRequested(this.metadata)):this.logger.log("[Conviva][Error] Session is not initialized")},n.prototype.attachPlayer=function(t){this.isInitialized()&&this.videoAnalytics?(this.internalPlayer=t,this.subscribeToInternalPlayerEvents(this.internalPlayer),this.logger.log("[Conviva] Player attached")):this.logger.log("[Conviva][Error] Session is not initialized")},n.prototype.setContentMetadata=function(t){this.videoAnalytics&&this.videoAnalytics.setContentInfo(t)},n.prototype.reportError=function(t){this.onError(t)},n.prototype.reportEvent=function(t,a){this.reportCustomEvent(t,a)},n.prototype.reportPlaybackMetricEvent=function(t,a,e){this.videoAnalytics&&this.reportPlaybackMetric(t,a,e)},n.prototype.reportPlaybackMetric=function(t,a,e){this.videoAnalytics&&this.videoAnalytics.reportPlaybackMetric(t,a,e)},n.prototype.reportCustomEvent=function(t,a){this.videoAnalytics&&this.videoAnalytics.reportPlaybackEvent(t,a)},n.prototype.reportAppBackgrounded=function(){Conviva.Analytics.reportAppBackgrounded()},n.prototype.reportAppForegrounded=function(){Conviva.Analytics.reportAppForegrounded()},n.prototype.setVastProperties=function(t,a){var e,n,i;a&&(t[Conviva.Constants.ASSET_NAME]=null!==(e=a.adTitle)&&void 0!==e?e:"ad name",t["c3.ad.system"]=null!==(n=a.adSystem)&&void 0!==n?n:"NA",t["c3.ad.creativeId"]=null!==(i=a.creativeId)&&void 0!==i?i:"NA")},n.prototype.setAdStreamUrl=function(t,a){a&&a.mediaUrl?t[Conviva.Constants.STREAM_URL]=a.mediaUrl:this.adMetadata&&this.adMetadata.adMediaUrl&&(t[Conviva.Constants.STREAM_URL]=this.adMetadata.adMediaUrl)},n.prototype.toC3AdFirstAdSystem=function(t){return t.vastProperties&&t.vastProperties.adSystem&&1===t.sequence?t.vastProperties.adSystem:"NA"},n.prototype.toC3AdFirstCreavtiveId=function(t){return t.vastProperties&&t.vastProperties.creativeId&&1===t.sequence?t.vastProperties.creativeId:"NA"},n.prototype.toC3AdFirstAdId=function(t){return 1===t.sequence?t.adID:"NA"},n}();return t.createConvivaSession=function(t,a,e,n){return new i(t,a,e,n)},t.version="7.0.56",Object.defineProperty(t,"__esModule",{value:!0}),t}({},flPlayerInterface,flFoundation);

